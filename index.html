<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>JapanGoï½œæ—¥æœ¬æ—…éŠäº’å‹•å¹³å°</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="indexstyle.css">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>

<header>
  <h1>JapanGo æ—¥æœ¬æ—…éŠäº’å‹•å¹³å°</h1>
  <p>æ—…éŠè·¯ç·š Ã— å…¥å¢ƒçŸ¥è­˜ Ã— æ—¥æ–‡å­¸ç¿’ Ã— å°éŠæˆ²</p>
</header>

<!-- ç®¡ç†è€…ç™»å…¥æŒ‰éˆ• -->
<button class="login-btn" onclick="openLogin()">ç®¡ç†è€…ç™»å…¥</button>

<!-- ç™»å…¥æ¡† -->
<div id="loginBox" class="login-box">
  <h3>ç®¡ç†è€…ç™»å…¥</h3>
  <input id="adminUser" placeholder="å¸³è™Ÿ"><br>
  <input id="adminPass" type="password" placeholder="å¯†ç¢¼"><br><br>
  <button onclick="login()">ç™»å…¥</button>
</div>

<!-- å°è¦½åˆ— -->
<nav class="navbar">
  <ul>
    <!-- ç™»å‡ºæœƒå“¡æŒ‰éˆ• -->
    <li id="logoutNavBtn" onclick="memberLogout()" style="display:none;">
      ğŸ”’ ç™»å‡ºæœƒå“¡
    </li>

    <li onclick="goTo('index.html')">é¦–é </li>
    <li onclick="goTo('customs.html')">å…¥å¢ƒæ³¨æ„</li>
    <li onclick="goTo('internal.html')">åœ‹å…§æ³¨æ„</li>
    <li onclick="goTo('Entryquiz.html')">å…¥å¢ƒ Q&A</li>
    <li onclick="goTo('quiz.html')">åœ‹å…§ Q&A</li>
    <li onclick="goTo('japanese.html')">æ—¥æ–‡å­¸ç¿’</li>
  </ul>
</nav>

<div class="container">
  <section class="map-area">
    <div class="section-title">æ—¥æœ¬æ—…éŠåœ°åœ–</div>
    <div id="map" style="height:300px;"></div>
  </section>
</div>

<section class="event-area">
  <div class="section-title">æ¨è–¦æ´»å‹•</div>
  <div class="filter-bar">
    <input
      type="text"
      id="searchInput"
      placeholder="ğŸ” æœå°‹æ´»å‹•æˆ–åœ°é»"
      oninput="renderEvents()"
    >

    <select id="regionFilter" onchange="renderEvents()">
      <option value="å…¨éƒ¨">å…¨éƒ¨åœ°å€</option>
      <option value="åŒ—æµ·é“">åŒ—æµ·é“</option>
      <option value="æœ¬æ´²">æœ¬æ´²</option>
      <option value="ä¹å·å››åœ‹">ä¹å·ãƒ»å››åœ‹</option>
    </select>
  </div>

  <h2 class="region-title">ğŸ“ åŒ—æµ·é“</h2>
  <div class="event-list" id="hokkaido"></div>
  <h2 class="region-title">ğŸ“ æœ¬æ´²</h2>
  <div class="event-list" id="honshu"></div>
  <h2 class="region-title">ğŸ“ ä¹å·ãƒ»å››åœ‹</h2>
  <div class="event-list" id="kyushu"></div>
</section>

<!-- ===== è·¯ç·šè¦åŠƒ UI ===== -->
<div class="route-ui">
  <!-- æŒ‰éˆ•ï¼šè¦åŠƒæˆ‘çš„æ—…éŠè·¯ç·š -->
  <button class="route-btn" onclick="openRoutePlanner()">
    ğŸ§­ è¦åŠƒæˆ‘çš„æ—…éŠè·¯ç·š
  </button>

  <!-- Panelï¼šè‡ªè¨‚æ—…éŠè·¯ç·š -->
  <div class="route-panel" id="routePanel">
    <h3>ğŸ§­ è‡ªè¨‚æ—…éŠè·¯ç·š</h3>
    <p>é»æ“Šåœ°åœ–åŠ å…¥è·¯ç·šç¯€é»</p>
    <button onclick="clearRoute()">ğŸ—‘ æ¸…é™¤è·¯ç·š</button>
    <span id="routeCount">ç›®å‰ç¯€é»ï¼š0</span>
  </div>

  
</div>

<!-- ===== æœƒå“¡ç™»å…¥ Modal ===== -->
<div id="memberLoginModal" class="modal" onclick="closeMemberLogin(event)">
  <div class="modal-content">
    <span class="close-btn" onclick="closeMemberLogin(event)">Ã—</span>
    <h3>æœƒå“¡ç™»å…¥</h3>
    <input id="memberUser" placeholder="æœƒå“¡å¸³è™Ÿ"><br>
    <input id="memberPass" type="password" placeholder="å¯†ç¢¼"><br><br>
    <button onclick="memberLogin()">ç™»å…¥</button>
  </div>
</div>

<!-- ===== æ´»å‹• Modal ===== -->
<div id="eventModal" class="modal" onclick="closeModal(event)">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal(event)">Ã—</span>
    <img id="modalImg">
    <h2 id="modalTitle"></h2>
    <p id="modalLocation"></p>
    <p id="modalDesc"></p>
    <p id="modalRoute"></p>
  </div>
</div>

<footer>
  Â© 2025 JapanGoï½œå‰ç«¯äº’å‹•å°ˆé¡Œ
</footer>

<script>
// --- ç®¡ç†è€…ç™»å…¥ ---
function openLogin() {
  const box = document.getElementById("loginBox");
  box.style.display = (box.style.display === "block") ? "none" : "block";
}

function login() {
  const user = document.getElementById("adminUser").value;
  const pass = document.getElementById("adminPass").value;
  if(user === "admin" && pass === "1234"){
    localStorage.setItem("admin","true");
    alert("ç™»å…¥æˆåŠŸï¼Œé€²å…¥ç®¡ç†æ¨¡å¼");
    window.location.href = "admin.html";
  } else {
    alert("å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤");
  }
}

// ===== æœƒå“¡ç™»å…¥ / ç™»å‡º / è·¯ç·šè¦åŠƒ =====
function openRoutePlanner() {
  const isLogin = localStorage.getItem("memberLogin") === "true";
  const panel = document.getElementById("routePanel");
  const btn = document.querySelector(".route-btn");
  const logoutBtn = document.getElementById("logoutBtn");

  if (!isLogin) {
    document.getElementById("memberLoginModal").style.display = "flex";
    return;
  }

  if (panel) panel.style.display = "block";
  if (btn) btn.style.display = "none";
  if (logoutBtn) logoutBtn.style.display = "inline-block";
}

function memberLogin() {
  const user = document.getElementById("memberUser").value;
  const pass = document.getElementById("memberPass").value;

  if (user === "user" && pass === "1234") {
    localStorage.setItem("memberLogin", "true");
    alert("æœƒå“¡ç™»å…¥æˆåŠŸï¼");
    document.getElementById("memberLoginModal").style.display = "none";
    openRoutePlanner();
  } else {
    alert("æœƒå“¡å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤");
  }
}

function updateRouteUI() {
  const isLogin = localStorage.getItem("memberLogin") === "true";

  const btn = document.querySelector(".route-btn");
  const panel = document.getElementById("routePanel");
  const logoutBtn = document.getElementById("logoutNavBtn");

  if (isLogin) {
    if (btn) btn.style.display = "none";
    if (panel) panel.style.display = "block";
    if (logoutBtn) logoutBtn.style.display = "inline-block";
  } else {
    if (btn) btn.style.display = "block";
    if (panel) panel.style.display = "none";
    if (logoutBtn) logoutBtn.style.display = "none";
  }
}

function memberLogout() {
  localStorage.removeItem("memberLogin");
  alert("å·²ç™»å‡ºæœƒå“¡");

  const panel = document.getElementById("routePanel");
  if(panel) panel.style.display = "none";

  const btn = document.querySelector(".route-btn");
  if(btn) btn.style.display = "block";

  const logoutBtn = document.getElementById("logoutNavBtn");
  if(logoutBtn) logoutBtn.style.display = "none";

  clearRoute();
}

function closeMemberLogin(e) {
  if(e.target.id === "memberLoginModal" || e.target.classList.contains("close-btn")) {
    document.getElementById("memberLoginModal").style.display = "none";
  }
}

// ===== é é¢è¼‰å…¥æ™‚æª¢æŸ¥æœƒå“¡ç™»å…¥ç‹€æ…‹ =====
window.onload = function() {
  const isLogin = localStorage.getItem("memberLogin") === "true";
  const panel = document.getElementById("routePanel");
  const btn = document.querySelector(".route-btn");
  const logoutBtn = document.getElementById("logoutBtn");

  if (isLogin) {
    if(panel) panel.style.display = "block";
    if(btn) btn.style.display = "none";
    if(logoutBtn) logoutBtn.style.display = "inline-block";
  } else {
    if(panel) panel.style.display = "none";
    if(btn) btn.style.display = "block";
    if(logoutBtn) logoutBtn.style.display = "none";
  }
};

// ===== å°è¦½åˆ— =====
function goTo(p){ location.href=p; }

// ===== æ´»å‹•è³‡æ–™ =====
const events = [
  {region:"åŒ—æµ·é“", title:"æœ­å¹Œé›ªç¥­", location:"æœ­å¹Œ", lat:43.0618, lng:141.3545, desc:"å†¬å­£å¿…çœ‹é›ªé›•æ´»å‹•", route:"æœ­å¹Œç«™ â†’ å¤§é€šå…¬åœ’", img:"imges/æœ­å¹Œé›ªç¥­.jpg"},
  {region:"åŒ—æµ·é“", title:"å°æ¨½é‹æ²³å¤œæ™¯", location:"å°æ¨½", lat:43.1971, lng:140.9947, desc:"å¾©å¤ç…¤æ°£ç‡ˆé»äº®çš„æµªæ¼«æ¸¯ç”º", route:"æœ­å¹Œç«™ â†’ å°æ¨½ç«™ â†’ é‹æ²³æ•£ç­–", img:"imges/åŒ—æµ·é“å°æ¨½é‹æ²³.jpg"},
  {region:"åŒ—æµ·é“", title:"æ—­å±±å‹•ç‰©åœ’", location:"æ—­å·", lat:43.7687, lng:142.3650, desc:"ä»¥å‹•ç‰©è¡Œå‹•å±•ç¤ºèåçš„è¶…äººæ°£å‹•ç‰©åœ’", route:"æ—­å·ç«™ â†’ æ—­å±±å‹•ç‰©åœ’", img:"imges/æ—­å±±å‹•ç‰©åœ’.jpg"},
  {region:"æœ¬æ´²", title:"æ±äº¬æ·ºè‰é›·é–€", location:"æ±äº¬", lat:35.7148, lng:139.7967, desc:"æ±äº¬æœ€å…·ä»£è¡¨æ€§çš„ä¸‹ç”ºæ–‡åŒ–", route:"æ·ºè‰ç«™ â†’ é›·é–€ â†’ ä»²è¦‹ä¸–é€š", img:"imges/æ±äº¬æ·ºè‰é›·é–€.jpg"},
  {region:"æœ¬æ´²", title:"å¯Œå£«å±±æ²³å£æ¹–", location:"å±±æ¢¨", lat:35.5171, lng:138.7516, desc:"æ¬£è³å¯Œå£«å±±å€’å½±çš„æœ€ä½³æ™¯é»", route:"æ–°å®¿ â†’ æ²³å£æ¹–", img:"imges/å¯Œå£«å±±æ²³å£æ¹–.jpg"},
  {region:"æœ¬æ´²", title:"å¤§é˜ªé“é “å €", location:"å¤§é˜ª", lat:34.6687, lng:135.5011, desc:"ç« é­šç‡’èˆ‡éœ“è™¹ç‡ˆçš„ç¾é£Ÿå¤©å ‚", route:"é›£æ³¢ç«™ â†’ é“é “å €", img:"imges/å¤§é˜ªé“é “å €.jpg"},
  {region:"æœ¬æ´²", title:"å¥ˆè‰¯æ¢…èŠ±é¹¿å…¬åœ’", location:"å¥ˆè‰¯", lat:34.6851, lng:135.8431, desc:"èˆ‡æ¢…èŠ±é¹¿è¿‘è·é›¢äº’å‹•çš„ä¸–ç•Œéºç”¢å…¬åœ’", route:"è¿‘éµå¥ˆè‰¯ç«™ â†’ å¥ˆè‰¯å…¬åœ’", img:"imges/å¥ˆè‰¯æ¢…èŠ±é¹¿å…¬åœ’.jpg"},
  {region:"æœ¬æ´²", title:"äº¬éƒ½æ¸…æ°´å¯º", location:"äº¬éƒ½", lat:35.0116, lng:135.7681, desc:"ä¸–ç•Œæ–‡åŒ–éºç”¢", route:"äº¬éƒ½ç«™ â†’ æ¸…æ°´å¯º", img:"imges/äº¬éƒ½æ¸…æ°´å¯º.jpg"},
  {region:"ä¹å·å››åœ‹", title:"ç¦å²¡å±‹å°", location:"ç¦å²¡", lat:33.5902, lng:130.4017, desc:"å¤œæ™šå±‹å°ç¾é£Ÿ", route:"åšå¤šç«™ â†’ ä¸­æ´²", img:"imges/ç¦å²¡å±‹å°.jpg"},
  {region:"ä¹å·å››åœ‹", title:"ç”±å¸ƒé™¢æº«æ³‰", location:"å¤§åˆ†", lat:33.2589, lng:131.3083, desc:"å……æ»¿æ–‡é’é¢¨æ ¼çš„æº«æ³‰å°é®", route:"åšå¤š â†’ ç”±å¸ƒé™¢", img:"imges/ç”±å¸ƒé™¢æº«æ³‰.jpg"},
  {region:"ä¹å·å››åœ‹", title:"é•·å´åŸçˆ†è³‡æ–™é¤¨", location:"é•·å´", lat:32.7733, lng:129.8635, desc:"äº†è§£æ­·å²ã€çæƒœå’Œå¹³çš„é‡è¦æ™¯é»", route:"é•·å´ç«™ â†’ åŸçˆ†è³‡æ–™é¤¨", img:"imges/é•·å´åŸçˆ†è³‡æ–™é¤¨.jpg"},
  {region:"ä¹å·å››åœ‹", title:"é«˜æ¾æ —æ—å…¬åœ’", location:"é¦™å·", lat:34.3389, lng:134.0434, desc:"æ—¥æœ¬ä¸‰å¤§ååœ’ä¹‹ä¸€çš„æ—¥å¼åº­åœ’", route:"é«˜æ¾ç«™ â†’ æ —æ—å…¬åœ’", img:"imges/é«˜æ¾æ —æ—å…¬åœ’.jpg"}
];

// ===== Leaflet åœ°åœ– =====
let map = L.map('map').setView([36.2,138.2],5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap'
}).addTo(map);

let marker, line;
let routePoints = [];
let userRouteLine = null;
let routeMarkers = [];

map.on("click", function (e) {
  const { lat, lng } = e.latlng;
  routePoints.push([lat,lng]);

  const m = L.circleMarker([lat, lng], {
    radius: 6, color: "#1976d2", fillColor: "#1976d2", fillOpacity: 1
  }).addTo(map);

  routeMarkers.push(m);
  drawUserRoute();
  document.getElementById("routeCount").innerText = "ç›®å‰ç¯€é»ï¼š" + routePoints.length;
});

function drawUserRoute() {
  if(userRouteLine) map.removeLayer(userRouteLine);
  if(routePoints.length >= 2){
    userRouteLine = L.polyline(routePoints, { color:"blue", weight:4 }).addTo(map);
  }
}

function clearRoute() {
  if(userRouteLine) { map.removeLayer(userRouteLine); userRouteLine=null; }
  routeMarkers.forEach(m=>map.removeLayer(m));
  routeMarkers=[];
  routePoints=[];
  document.getElementById("routeCount").innerText="ç›®å‰ç¯€é»ï¼š0";
  alert("è·¯ç·šå·²æ¸…ç©ºï¼Œè«‹é‡æ–°è¦åŠƒ");
}

// ===== æ´»å‹•å¡ç‰‡æ¸²æŸ“ =====
function renderEvents() {
  const keyword = document.getElementById("searchInput").value.toLowerCase();
  const region = document.getElementById("regionFilter").value;

  hokkaido.innerHTML = "";
  honshu.innerHTML = "";
  kyushu.innerHTML = "";

  events.filter(e => {
    const matchText = e.title.toLowerCase().includes(keyword) || e.location.toLowerCase().includes(keyword);
    const matchRegion = region === "å…¨éƒ¨" || e.region === region;
    return matchText && matchRegion;
  }).forEach(e => {
    const card = `
      <div class="event-card"
        onclick="selectEvent(${e.lat},${e.lng},'${e.title}','${e.location}','${e.desc}','${e.route}')">
        <div class="event-img" style="background-image:url('${e.img || 'images/default.jpg'}')"></div>
        <div class="event-info">
          <h3>${e.title}</h3>
          <p>ğŸ“ ${e.location}</p>
          <p>${e.desc}</p>
        </div>
      </div>
    `;
    if(e.region==="åŒ—æµ·é“") hokkaido.innerHTML += card;
    if(e.region==="æœ¬æ´²") honshu.innerHTML += card;
    if(e.region==="ä¹å·å››åœ‹") kyushu.innerHTML += card;
  });
}

// ===== é»æ“Šæ´»å‹•å¡ç‰‡ =====
function selectEvent(lat, lng, title, loc, desc, route) {
  map.setView([lat,lng],13);
  if(marker) map.removeLayer(marker);
  if(line) map.removeLayer(line);

  marker = L.marker([lat,lng]).addTo(map).bindPopup(`<b>${title}</b><br>${loc}`).openPopup();
  line = L.polyline([[lat-0.03, lng-0.03],[lat,lng]], {color:'red'}).addTo(map);

  document.getElementById("modalImg").src = events.find(e=>e.title===title && e.location===loc).img;
  document.getElementById("modalTitle").innerText = title;
  document.getElementById("modalLocation").innerText = "ğŸ“ " + loc;
  document.getElementById("modalDesc").innerText = desc;
  document.getElementById("modalRoute").innerText = "ğŸš¶ è·¯ç·šï¼š" + route;
  document.getElementById("eventModal").style.display="flex";
}

function closeModal(e) {
  if(e.target.id==="eventModal" || e.target.classList.contains("close-btn")) {
    document.getElementById("eventModal").style.display="none";
  }
}

// åˆæ¬¡æ¸²æŸ“æ´»å‹•å¡ç‰‡
renderEvents();
</script>
</body>
</html>
